<!DOCTYPE html>
<html lang="uk">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Crypto Orderbook Dashboard</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 0;
      padding: 20px;
      background-color: #1a1a1a;
      color: #ffffff;
      transition: background-color 0.3s, color 0.3s;
    }
    .container {
      max-width: 1200px;
      margin: 0 auto;
      background-color: #2d2d2d;
      border-radius: 10px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.3);
      padding: 25px;
    }
    h1 {
      text-align: center;
      color: #ffffff;
      margin-bottom: 20px;
      font-size: 28px;
    }
    .header-container {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 30px;
    }
    .status {
      display: flex;
      align-items: center;
      background-color: #333333;
      padding: 8px 15px;
      border-radius: 20px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.2);
    }
    .status-indicator {
      width: 12px;
      height: 12px;
      border-radius: 50%;
      margin-right: 10px;
    }
    .connected {
      background-color: #10b981;
      box-shadow: 0 0 5px #10b981;
    }
    .disconnected {
      background-color: #ef4444;
      box-shadow: 0 0 5px #ef4444;
    }
    .controls {
      display: flex;
      justify-content: space-between;
      margin-bottom: 20px;
      flex-wrap: wrap;
      gap: 10px;
    }
    .control-group {
      display: flex;
      gap: 10px;
    }
    button {
      padding: 10px 16px;
      background-color: #222c3d;
      color: white;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      font-weight: 500;
      transition: background-color 0.2s;
    }
    button:hover {
      background-color: #131a27;
    }
    .refresh-btn {
      background-color: #10b981;
    }
    .refresh-btn:hover {
      background-color: #059669;
    }
    .arb-btn {
      background-color: #f59e0b;
    }
    .arb-btn:hover {
      background-color: #d97706;
    }
    .threshold-controls {
      display: flex;
      gap: 15px;
      margin-bottom: 20px;
      background-color: #2d2d2d;
      padding: 15px;
      border-radius: 8px;
    }
    .threshold-group {
      display: flex;
      flex-direction: column;
      flex: 1;
    }
    .threshold-group label {
      margin-bottom: 5px;
      font-weight: bold;
      font-size: 14px;
      color: #ffffff;
    }
    .threshold-group input {
      width: 100%;
    }
    .threshold-value {
      margin-top: 5px;
      font-size: 14px;
      color: #ffffff;
      text-align: center;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-bottom: 20px;
      box-shadow: 0 2px 5px rgba(0,0,0,0.2);
      background-color: #2d2d2d;
    }
    th, td {
      border: 1px solid #444444;
      padding: 12px;
      text-align: center;
      color: #ffffff;
    }
    th {
      background-color: #333333;
      font-weight: bold;
      color: #ffffff;
    }
    .token-cell {
      font-weight: bold;
      background-color: #333333;
      color: #ffffff;
    }
    .type-cell {
      font-weight: bold;
      width: 60px;
      background-color: #333333;
      color: #ffffff;
    }
    .sell-price {
      color: #ef4444 !important;
    }
    .buy-price {
      color: #10b981 !important;
    }
    .highlight-green {
      color: #10b981;
      font-weight: bold;
    }
    .highlight-red {
      color: #ef4444;
      font-weight: bold;
    }
    .opportunities {
      margin-top: 30px;
      padding: 15px;
      background-color: #2d2d2d;
      border-radius: 8px;
      border-left: 4px solid #131b29;
    }
    .opportunities h2 {
      margin-top: 0;
      font-size: 20px;
      color: #ffffff;
    }
    .opportunity-item {
      padding: 10px;
      margin-bottom: 10px;
      background-color: #333333;
      border-radius: 6px;
      box-shadow: 0 1px 3px rgba(0,0,0,0.2);
      color: #ffffff;
    }
    .hidden {
      display: none;
    }
    .exchange-status {
      display: inline-flex;
      align-items: center;
      margin-left: 5px;
    }
    .exchange-status-indicator {
      width: 8px;
      height: 8px;
      border-radius: 50%;
      margin-right: 5px;
    }
    .exchange-connected {
      background-color: #10b981;
      box-shadow: 0 0 3px #10b981;
    }
    .exchange-disconnected {
      background-color: #ef4444;
      box-shadow: 0 0 3px #ef4444;
    }
    .exchange-no-data {
      background-color: #f59e0b;
      box-shadow: 0 0 3px #f59e0b;
    }
    .status-legend {
      position: fixed;
      right: 20px;
      top: 20px;
      background-color: #2d2d2d;
      padding: 15px;
      border-radius: 8px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.2);
      font-size: 14px;
      color: #ffffff;
    }
    .status-legend h3 {
      margin: 0 0 15px 0;
      color: #ffffff;
      font-size: 16px;
      border-bottom: 1px solid #444;
      padding-bottom: 10px;
    }
    .status-legend-items {
      margin-bottom: 15px;
    }
    .status-legend-item {
      display: flex;
      align-items: center;
      margin-bottom: 8px;
    }
    .status-legend-item:last-child {
      margin-bottom: 0;
    }
    .orderbook-tables-container {
      margin: 20px 0;
      padding: 15px;
      background-color: #1a1a1a;
      border-radius: 8px;
    }
    .orderbook-tables-row {
      display: flex;
      gap: 20px;
      margin-bottom: 20px;
    }
    .orderbook-tables-row:last-child {
      margin-bottom: 0;
    }
    .orderbook-table-container {
      flex: 1;
      background-color: #2d2d2d;
      border-radius: 8px;
      padding: 15px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.2);
    }
    .orderbook-controls {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 15px;
      padding: 10px;
      background-color: #333333;
      border-radius: 6px;
    }
    .orderbook-select {
      padding: 8px;
      border: 1px solid #444444;
      border-radius: 4px;
      background-color: #2d2d2d;
      color: #ffffff;
      font-size: 14px;
      min-width: 150px;
    }
    .orderbook-title {
      margin: 0;
      font-size: 16px;
      color: #ffffff;
      text-align: center;
      font-weight: 600;
    }
    .orderbook-content {
      display: flex;
      flex-direction: column;
      gap: 15px;
    }
    .orderbook-row {
      display: flex;
      flex-direction: column;
      gap: 15px;
    }
    .orderbook-side {
      flex: 1;
      margin-bottom: 0;
    }
    .orderbook-side h4 {
      margin: 0 0 8px 0;
      color: #374151;
      font-size: 14px;
      text-align: center;
      font-weight: 600;
    }
    .orderbook-side h4:first-child {
      color: #ef4444;
    }
    .orderbook-side h4:last-child {
      color: #10b981;
    }
    .orderbook-table {
      width: 100%;
      border-collapse: collapse;
      font-size: 14px;
      overflow-x: hidden;
      background-color: #2d2d2d;
    }
    .orderbook-table th {
      background-color: #333333;
      padding: 8px;
      font-weight: 600;
      color: #ffffff;
      font-size: 13px;
      border: 1px solid #444444;
    }
    .orderbook-table td {
      padding: 8px;
      text-align: right;
      font-family: monospace;
      font-size: 13px;
      color: #ffffff;
      border: 1px solid #444444;
    }
    .orderbook-table tbody tr {
      position: relative;
    }
    .orderbook-table tbody tr.buy {
      color: #10b981;
      background-color: rgba(16, 185, 129, 0.05);
    }
    .orderbook-table tbody tr:hover {
      background-color: rgba(0,0,0,0.02);
    }
    .orderbook-table .price {
      font-weight: 600;
    }
    .orderbook-table .amount {
      color: #9ca3af;
    }
    .orderbook-table .total {
      color: #9ca3af;
      font-weight: 500;
    }
    .orderbook-table .depth {
      color: #9ca3af;
    }
    .orderbook-table tbody {
      display: block;
      max-height: calc(24px * 10);
      overflow-y: auto;
      overflow-x: hidden;
      scrollbar-width: thin;
      scrollbar-color: #444444 #1a1a1a;
    }
    .orderbook-table thead {
      display: table;
      width: 100%;
      table-layout: fixed;
    }
    .orderbook-table tbody tr {
      display: table;
      width: 100%;
      table-layout: fixed;
    }
    .theme-toggle {
      width: 100%;
      margin-top: 10px;
      background-color: #333333;
      color: #ffffff;
      border: none;
      padding: 8px;
      border-radius: 6px;
      cursor: pointer;
      font-size: 14px;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
    }
    .theme-toggle:hover {
      background-color: #404040;
    }
    .light-theme .container {
      background-color: #ffffff;
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
    }
    .light-theme h1 {
      color: #1a1a1a;
    }
    .light-theme .status {
      background-color: #f9f9f9;
      box-shadow: 0 2px 4px rgba(0,0,0,0.05);
    }
    .light-theme .theme-toggle {
      background-color: #f0f2f5;
      color: #333333;
    }
    .light-theme .theme-toggle:hover {
      background-color: #e5e7eb;
    }
    .light-theme .status-legend {
      background-color: white;
      color: #333333;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    .light-theme .status-legend h3 {
      color: #374151;
      border-bottom-color: #e5e7eb;
    }
    .light-theme .orderbook-table-container {
      background-color: white;
      box-shadow: 0 2px 4px rgba(0,0,0,0.05);
    }
    .light-theme .orderbook-controls {
      background-color: #f3f4f6;
    }
    .light-theme .orderbook-select {
      background-color: white;
      border-color: #e5e7eb;
      color: #374151;
    }
    .light-theme .orderbook-title {
      color: #374151;
    }
    .light-theme .orderbook-table {
      background-color: white;
    }
    .light-theme .orderbook-table th {
      background-color: #f3f4f6;
      color: #374151;
      border-color: #e5e7eb;
    }
    .light-theme .orderbook-table td {
      color: #374151;
      border-color: #e5e7eb;
    }
    .light-theme .orderbook-tables-container {
      background-color: #f9f9f9;
    }
    .light-theme .threshold-controls {
      background-color: #f9f9f9;
    }
    .light-theme .threshold-group label {
      color: #374151;
    }
    .light-theme .threshold-value {
      color: #6b7280;
    }
    .light-theme table {
      background-color: #ffffff;
      box-shadow: 0 2px 5px rgba(0,0,0,0.05);
    }
    .light-theme th, 
    .light-theme td {
      border-color: #e5e7eb;
      color: #374151;
    }
    .light-theme th {
      background-color: #f3f4f6;
      color: #374151;
    }
    .light-theme .token-cell {
      background-color: #f9fafb;
      color: #111827;
    }
    .light-theme .type-cell {
      background-color: #f3f4f6;
      color: #374151;
    }
    .light-theme .opportunities {
      background-color: #f0f9ff;
    }
    .light-theme .opportunities h2 {
      color: #1e40af;
    }
    .light-theme .opportunity-item {
      background-color: white;
      color: #374151;
    }
    .light-theme .orderbook-table .amount,
    .light-theme .orderbook-table .total,
    .light-theme .orderbook-table .depth {
      color: #6b7280;
    }
    .light-theme .orderbook-table tbody {
      scrollbar-color: #d1d5db #f0f2f5;
    }
    /* –°—Ç–∏–ª—ñ –¥–ª—è —Å–∫—Ä–æ–ª–±–∞—Ä—ñ–≤ */
    ::-webkit-scrollbar {
      width: 8px;
      height: 8px;
    }

    ::-webkit-scrollbar-track {
      background: #1a1a1a;
      border-radius: 4px;
    }

    ::-webkit-scrollbar-thumb {
      background: #444444;
      border-radius: 4px;
    }

    ::-webkit-scrollbar-thumb:hover {
      background: #555555;
    }

    /* –°–∫—Ä–æ–ª–±–∞—Ä–∏ –¥–ª—è —Å–≤—ñ—Ç–ª–æ—ó —Ç–µ–º–∏ */
    .light-theme ::-webkit-scrollbar-track {
      background: #f0f2f5;
    }

    .light-theme ::-webkit-scrollbar-thumb {
      background: #d1d5db;
    }

    .light-theme ::-webkit-scrollbar-thumb:hover {
      background: #9ca3af;
    }

    /* –°—Ç–∏–ª—ñ –¥–ª—è –±—ñ–≥—É–Ω–∫—ñ–≤ */
    input[type="range"] {
      -webkit-appearance: none;
      width: 100%;
      height: 6px;
      background: #444444;
      border-radius: 3px;
      outline: none;
    }

    input[type="range"]::-webkit-slider-thumb {
      -webkit-appearance: none;
      width: 18px;
      height: 18px;
      background: #111c2e;
      border-radius: 50%;
      cursor: pointer;
      transition: background 0.2s;
    }

    input[type="range"]::-webkit-slider-thumb:hover {
      background: #111113;
    }

    /* –ë—ñ–≥—É–Ω–∫–∏ –¥–ª—è —Å–≤—ñ—Ç–ª–æ—ó —Ç–µ–º–∏ */
    .light-theme input[type="range"] {
      background: #e5e7eb;
    }

    .light-theme input[type="range"]::-webkit-slider-thumb {
      background: #23334d;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }

    .light-theme input[type="range"]::-webkit-slider-thumb:hover {
      background: #090d16;
    }

    .threshold-group input {
      width: 100%;
      margin: 10px 0;
    }

    .threshold-value {
      margin-top: 5px;
      font-size: 14px;
      color: #ffffff;
      text-align: center;
      font-weight: 500;
    }

    .token-input {
      padding: 8px 12px;
      background-color: #333333;
      border: 1px solid #444444;
      border-radius: 6px;
      color: #ffffff;
      font-size: 14px;
      min-width: 300px;
      outline: none;
      transition: border-color 0.2s;
    }
    
    .token-input:focus {
      border-color: #3b82f6;
    }
    
    .light-theme .token-input {
      background-color: #ffffff;
      border-color: #e5e7eb;
      color: #374151;
    }
    
    .light-theme .token-input:focus {
      border-color: #3b82f6;
    }

    .add-token-btn {
      background-color: #10b981;
      padding: 8px 16px;
    }
    
    .add-token-btn:hover {
      background-color: #059669;
    }
    
    .remove-token-btn {
      background-color: #ef4444;
      padding: 8px 16px;
    }
    
    .remove-token-btn:hover {
      background-color: #dc2626;
    }

    /* –°—Ç–∏–ª—ñ –¥–ª—è —Å–ø–ª–∏–≤–∞—é—á–∏—Ö –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω—å */
    .toast-container {
      position: fixed;
      top: 20px;
      right: 20px;
      z-index: 1000;
    }

    .toast {
      background-color: #333333;
      color: white;
      padding: 12px 24px;
      border-radius: 6px;
      margin-bottom: 10px;
      box-shadow: 0 2px 5px rgba(0,0,0,0.2);
      display: flex;
      align-items: center;
      animation: slideIn 0.3s ease-out;
    }

    .toast.success {
      background-color: #10b981;
    }

    .toast.error {
      background-color: #ef4444;
    }

    @keyframes slideIn {
      from {
        transform: translateX(100%);
        opacity: 0;
      }
      to {
        transform: translateX(0);
        opacity: 1;
      }
    }

    .light-theme .toast {
      background-color: #ffffff;
      color: #333333;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
    }

    .light-theme .toast.success {
      background-color: #d1fae5;
      color: #065f46;
    }

    .light-theme .toast.error {
      background-color: #fee2e2;
      color: #991b1b;
    }
  </style>
</head>
<body>
  <div class="status-legend">
    <h3>–°—Ç–∞—Ç—É—Å –±—ñ—Ä–∂</h3>
    <div class="status-legend-items">
      <div class="status-legend-item">
        <div class="exchange-status-indicator exchange-connected"></div>
        <span>–Ñ –¥–∞–Ω—ñ</span>
      </div>
      <div class="status-legend-item">
        <div class="exchange-status-indicator exchange-no-data"></div>
        <span>–ù–µ–º–∞—î –¥–∞–Ω–∏—Ö</span>
      </div>
      <div class="status-legend-item">
        <div class="exchange-status-indicator exchange-disconnected"></div>
        <span>–í—ñ–¥–∫–ª—é—á–µ–Ω–æ</span>
      </div>
    </div>
    <button id="theme-toggle" class="theme-toggle">
      <span id="theme-icon">‚òÄÔ∏è</span>
      <span id="theme-text">–°–≤—ñ—Ç–ª–∞ —Ç–µ–º–∞</span>
    </button>
  </div>
  <div class="container">
    <div class="header-container">
      <h1>Crypto Orderbook Dashboard</h1>
      <div class="header-right">
        <div class="status">
          <div id="status-indicator" class="status-indicator disconnected"></div>
          <span id="status-text">Disconnected</span>
        </div>
      </div>
    </div>
    <div class="orderbook-tables-container">
      <div class="orderbook-tables-row">
        <div class="orderbook-table-container">
          <div class="orderbook-controls">
            <div style="display: flex; gap: 10px;">
              <select class="orderbook-select" id="left-exchange-select">
                <option value="">–í–∏–±–µ—Ä—ñ—Ç—å –±—ñ—Ä–∂—É</option>
              </select>
              <select class="orderbook-select" id="left-token-select">
                <option value="">–í–∏–±–µ—Ä—ñ—Ç—å —Ç–æ–∫–µ–Ω</option>
              </select>
            </div>
            <h3 class="orderbook-title">Orderbook Left</h3>
          </div>
          <div class="orderbook-content">
            <div class="orderbook-row">
              <div class="orderbook-side">
                <table class="orderbook-table">
                  <thead>
                    <tr>
                      <th>Price</th>
                      <th>Quantity</th>
                      <th>Sum (USDT)</th>
                      <th>Depth (USDT)</th>
                    </tr>
                  </thead>
                  <tbody id="orderbook-left-sell"></tbody>
                </table>
              </div>
              <div class="orderbook-side">
                <table class="orderbook-table">
                  <tbody id="orderbook-left-buy"></tbody>
                  <thead>
                    <tr>
                      <th>Price</th>
                      <th>Quantity</th>
                      <th>Sum (USDT)</th>
                      <th>Depth (USDT)</th>
                    </tr>
                  </thead>
                </table>
              </div>
            </div>
          </div>
        </div>
        <div class="orderbook-table-container">
          <div class="orderbook-controls">
            <div style="display: flex; gap: 10px;">
              <select class="orderbook-select" id="right-exchange-select">
                <option value="">–í–∏–±–µ—Ä—ñ—Ç—å –±—ñ—Ä–∂—É</option>
              </select>
              <select class="orderbook-select" id="right-token-select">
                <option value="">–í–∏–±–µ—Ä—ñ—Ç—å —Ç–æ–∫–µ–Ω</option>
              </select>
            </div>
            <h3 class="orderbook-title">Orderbook Right</h3>
          </div>
          <div class="orderbook-content">
            <div class="orderbook-row">
              <div class="orderbook-side">
                <table class="orderbook-table">
                  <thead>
                    <tr>
                      <th>Price</th>
                      <th>Quantity</th>
                      <th>Sum (USDT)</th>
                      <th>Depth (USDT)</th>
                    </tr>
                  </thead>
                  <tbody id="orderbook-right-sell"></tbody>
                </table>
              </div>
              <div class="orderbook-side">
                <table class="orderbook-table">
                  <tbody id="orderbook-right-buy"></tbody>
                  <thead>
                    <tr>
                      <th>Price</th>
                      <th>Quantity</th>
                      <th>Sum (USDT)</th>
                      <th>Depth (USDT)</th>
                    </tr>
                  </thead>
                </table>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    <div class="threshold-controls">
      <div class="threshold-group">
        <label for="percent-threshold">Percent Threshold:</label>
        <input id="percent-threshold" type="range" min="0.1" max="10" step="0.1" value="2.0">
        <div class="threshold-value"><span id="percent-value">2.0</span>%</div>
      </div>
      <div class="threshold-group">
        <label for="delta-threshold">Delta Threshold (USDT):</label>
        <input id="delta-threshold" type="range" min="0.1" max="5" step="0.1" value="0.5">
        <div class="threshold-value">$<span id="delta-value">0.5</span></div>
      </div>
    </div>
    <div class="controls">
      <div class="control-group">
        <input type="text" id="token-input" class="token-input" placeholder="–í–≤–µ–¥—ñ—Ç—å –Ω–∞–∑–≤—É —Ç–æ–∫–µ–Ω–∞ –¥–ª—è –ø–æ—à—É–∫—É –∞–±–æ –¥–æ–¥–∞–≤–∞–Ω–Ω—è..." pattern="[A-Za-z0-9]+" title="–¢—ñ–ª—å–∫–∏ –ª—ñ—Ç–µ—Ä–∏ –∞–Ω–≥–ª—ñ–π—Å—å–∫–æ–≥–æ –∞–ª—Ñ–∞–≤—ñ—Ç—É —Ç–∞ —Ü–∏—Ñ—Ä–∏">
        <button id="search-btn" class="search-btn">–ü–æ—à—É–∫</button>
        <button id="add-token-btn" class="add-token-btn">–î–æ–¥–∞—Ç–∏ —Ç–æ–∫–µ–Ω</button>
        <button id="remove-token-btn" class="remove-token-btn">–í–∏–¥–∞–ª–∏—Ç–∏ —Ç–æ–∫–µ–Ω</button>
        <button id="refresh-btn" class="refresh-btn">–û–Ω–æ–≤–∏—Ç–∏ –¥–∞–Ω—ñ</button>
        <button id="find-arb-btn" class="arb-btn">–ó–Ω–∞–π—Ç–∏ –∞—Ä–±—ñ—Ç—Ä–∞–∂</button>
      </div>
      <div>
        <select id="token-filter">
          <option value="all">–í—Å—ñ —Ç–æ–∫–µ–Ω–∏</option>
        </select>
      </div>
    </div>
    <table id="orderbook-table">
      <thead>
        <tr>
          <th>Token</th>
          <th>Type</th>
          <th id="exchanges-header">Loading...</th>
        </tr>
      </thead>
      <tbody id="orderbook-body">
        <tr>
          <td colspan="3">Loading data...</td>
        </tr>
      </tbody>
    </table>
    <div id="opportunities" class="opportunities hidden">
      <h2>Arbitrage Opportunities</h2>
      <div id="opportunities-list"></div>
    </div>
  </div>
  <div class="toast-container" id="toastContainer"></div>

  <script>
    // WebSocket URL
    const WS_URL = 'ws://localhost:8000/ws';
    let socket = null;
    let reconnectTimeout = null;
    let reconnectAttempts = 0;
    let maxReconnectAttempts = 10;

    // –î–∞–Ω—ñ –æ—Ä–¥–µ—Ä–±—É–∫—É, —Ç–æ–∫–µ–Ω–∏, –±—ñ—Ä–∂—ñ
    let tokens = [];
    let exchanges = [];
    let orderbooks = {};

    // –ü–æ—Ä–æ–≥–æ–≤—ñ –∑–Ω–∞—á–µ–Ω–Ω—è
    const thresholds = {
      percentThreshold: 2.0,
      deltaThreshold: 0.5
    };

    // –ì–ª–æ–±–∞–ª—å–Ω—ñ DOM –µ–ª–µ–º–µ–Ω—Ç–∏
    let leftExchangeSelect, leftTokenSelect, rightExchangeSelect, rightTokenSelect;

    // DOM –µ–ª–µ–º–µ–Ω—Ç–∏
    const percentThresholdInput = document.getElementById('percent-threshold');
    const deltaThresholdInput = document.getElementById('delta-threshold');
    const percentValueText = document.getElementById('percent-value');
    const deltaValueText = document.getElementById('delta-value');
    const refreshButton = document.getElementById('refresh-btn');
    const findArbButton = document.getElementById('find-arb-btn');
    const tokenFilter = document.getElementById('token-filter');
    const opportunitiesSection = document.getElementById('opportunities');
    const opportunitiesList = document.getElementById('opportunities-list');

    // –Ü–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—è –∑–Ω–∞—á–µ–Ω—å
    percentThresholdInput.value = thresholds.percentThreshold;
    deltaThresholdInput.value = thresholds.deltaThreshold;
    percentValueText.textContent = thresholds.percentThreshold;
    deltaValueText.textContent = thresholds.deltaThreshold;

    percentThresholdInput.addEventListener('input', function() {
      thresholds.percentThreshold = parseFloat(this.value);
      percentValueText.textContent = thresholds.percentThreshold;
      renderTable();
    });
    deltaThresholdInput.addEventListener('input', function() {
      thresholds.deltaThreshold = parseFloat(this.value);
      deltaValueText.textContent = thresholds.deltaThreshold;
      renderTable();
    });
    tokenFilter.addEventListener('change', function() {
      renderTable();
    });
    refreshButton.addEventListener('click', function() {
      refreshPrices();
    });
    findArbButton.addEventListener('click', function() {
      findArbitrageOpportunities();
    });

    function connect() {
      socket = new WebSocket(WS_URL);
      socket.onopen = () => {
        console.log('WebSocket connected');
        setConnectionStatus(true);
        reconnectAttempts = 0;
      };
      socket.onclose = (event) => {
        console.log(`WebSocket closed: ${event.code} - ${event.reason}`);
        setConnectionStatus(false);
        scheduleReconnect();
      };
      socket.onerror = (error) => {
        console.error('WebSocket error:', error);
      };
      socket.onmessage = (event) => {
        try {
          const message = JSON.parse(event.data);
          handleMessage(message);
        } catch (error) {
          console.error('Error parsing message:', error);
        }
      };
    }

    function scheduleReconnect() {
      if (reconnectTimeout) clearTimeout(reconnectTimeout);
      if (reconnectAttempts < maxReconnectAttempts) {
        reconnectAttempts++;
        const delay = 2000 * Math.pow(1.5, reconnectAttempts - 1);
        console.log(`Reconnecting in ${delay/1000} seconds (attempt ${reconnectAttempts}/${maxReconnectAttempts})`);
        reconnectTimeout = setTimeout(() => { connect(); }, delay);
      } else {
        console.error('Max reconnect attempts reached');
      }
    }

    function setConnectionStatus(isConnected) {
      const indicator = document.getElementById('status-indicator');
      const text = document.getElementById('status-text');
      if (isConnected) {
        indicator.classList.remove('disconnected');
        indicator.classList.add('connected');
        text.textContent = 'Connected';
      } else {
        indicator.classList.remove('connected');
        indicator.classList.add('disconnected');
        text.textContent = 'Disconnected';
      }
    }

    function handleMessage(message) {
      const type = message.type;
      console.log('Received message type:', type);
      switch (type) {
        case 'initial_data':
          tokens = message.tokens || [];
          exchanges = message.exchanges.map(e => e.name) || [];
          orderbooks = message.orderbooks || {};
          window.lastData = { tokens, exchanges, orderbooks };
          updateTokenFilter();
          renderTable();
          break;
        case 'orderbook_update':
          updateOrderbook(message);
          break;
        case 'orderbook_data':
          console.log('Orderbook data received:', message);
          const { token, exchange, data } = message;
          console.log('Processing orderbook data:', { token, exchange, data });
          
          if (!data || !data.asks || !data.bids) {
              console.error('Invalid orderbook data format:', data);
              return;
          }
          
          const asks = data.asks;
          const bids = data.bids;
          
          console.log('Orders to display:', { 
              asks_count: asks.length, 
              bids_count: bids.length 
          });
          
          // –í–∏–∑–Ω–∞—á–µ–Ω–Ω—è, —è–∫–∞ —Ç–∞–±–ª–∏—Ü—è (–ª—ñ–≤–∞ —á–∏ –ø—Ä–∞–≤–∞) –æ–Ω–æ–≤–ª—é—î—Ç—å—Å—è
          const isRightClick = document.querySelector('.orderbook-table-container:last-child')
                                  .querySelector('.orderbook-title').textContent.includes(token);
          
          if (isRightClick) {
              fillOrderbookTable(document.getElementById('orderbook-right-sell'), asks, true);
              fillOrderbookTable(document.getElementById('orderbook-right-buy'), bids, false);
              // –í—Å—Ç–∞–Ω–æ–≤–ª—é—î–º–æ —Å–∫—Ä–æ–ª –¥–ª—è sell —Ç–∞–±–ª–∏—Ü—ñ –≤ –Ω–∏–∂–Ω—é –ø–æ–∑–∏—Ü—ñ—é
              const sellTable = document.getElementById('orderbook-right-sell');
              sellTable.scrollTop = sellTable.scrollHeight;
          } else {
              fillOrderbookTable(document.getElementById('orderbook-left-sell'), asks, true);
              fillOrderbookTable(document.getElementById('orderbook-left-buy'), bids, false);
              // –í—Å—Ç–∞–Ω–æ–≤–ª—é—î–º–æ —Å–∫—Ä–æ–ª –¥–ª—è sell —Ç–∞–±–ª–∏—Ü—ñ –≤ –Ω–∏–∂–Ω—é –ø–æ–∑–∏—Ü—ñ—é
              const sellTable = document.getElementById('orderbook-left-sell');
              sellTable.scrollTop = sellTable.scrollHeight;
          }
          break;
        case 'token_added':
          tokens.push(message.token);
          updateTokenFilter();
          renderTable();
          showToast(`–¢–æ–∫–µ–Ω ${message.token} —É—Å–ø—ñ—à–Ω–æ –¥–æ–¥–∞–Ω–æ`, 'success');
          break;
        case 'token_removed':
          tokens = tokens.filter(t => t !== message.token);
          updateTokenFilter();
          renderTable();
          showToast(`–¢–æ–∫–µ–Ω ${message.token} —É—Å–ø—ñ—à–Ω–æ –≤–∏–¥–∞–ª–µ–Ω–æ`, 'success');
          break;
        case 'exchange_added':
          exchanges.push(message.exchange.name);
          renderTable();
          break;
        case 'exchange_removed':
          exchanges = exchanges.filter(e => e !== message.exchange);
          renderTable();
          break;
        case 'orderbooks_cleared':
          orderbooks = {};
          renderTable();
          break;
        case 'full_table_update':
          orderbooks = message.data;
          renderTable();
          break;
        case 'error':
          console.error('Server error:', message.message);
          showToast(message.message, 'error');
          break;
        default:
          console.warn('Unknown message type:', type);
          break;
      }
    }

    function updateTokenFilter() {
      const currentValue = tokenFilter.value;
      tokenFilter.innerHTML = '<option value="all">All Tokens</option>';
      tokens.forEach(token => {
        const option = document.createElement('option');
        option.value = token;
        option.textContent = token;
        tokenFilter.appendChild(option);
      });
      if (currentValue !== 'all' && tokens.includes(currentValue)) {
        tokenFilter.value = currentValue;
      }
    }

    function updateOrderbook(data) {
      const { exchange, token, best_sell, best_buy } = data;
      if (!orderbooks[token]) orderbooks[token] = {};
      orderbooks[token][exchange] = { best_sell, best_buy };
      updateTableCell(token, exchange, 'sell', best_sell);
      updateTableCell(token, exchange, 'buy', best_buy);
    }

    function updateTableCell(token, exchange, type, value) {
      const cell = document.getElementById(`${token}-${exchange}-${type}`);
      if (cell) {
        cell.textContent = value;
        updateCellHighlighting(cell, token, exchange, type, value);
      }
    }

    function calculatePercent(value1, value2) {
      return ((value1 - value2) / value2) * 100;
    }
    function calculateDelta(value1, value2) {
      return value1 - value2;
    }
    function updateCellHighlighting(cell, token, exchange, type, value) {
      cell.classList.remove('highlight-green', 'highlight-red');
      if (value === 'X X X' || exchanges.length < 2) return;
      const currentValue = parseFloat(value);
      if (isNaN(currentValue)) return;
      for (const otherExchange of exchanges) {
        if (otherExchange === exchange) continue;
        if (!orderbooks[token] || !orderbooks[token][otherExchange]) continue;
        const otherValue = orderbooks[token][otherExchange][type === 'sell' ? 'best_sell' : 'best_buy'];
        if (otherValue === 'X X X') continue;
        const otherValueFloat = parseFloat(otherValue);
        if (isNaN(otherValueFloat)) continue;
        const percent = calculatePercent(currentValue, otherValueFloat);
        const delta = calculateDelta(currentValue, otherValueFloat);
        if (type === 'sell') {
          if ((percent <= -thresholds.percentThreshold) || (delta <= -thresholds.deltaThreshold)) {
            cell.classList.add('highlight-green');
            break;
          }
        } else {
          if ((percent >= thresholds.percentThreshold) || (delta >= thresholds.deltaThreshold)) {
            cell.classList.add('highlight-green');
            break;
          }
        }
      }
    }

    // –û–Ω–æ–≤–ª–µ–Ω–Ω—è —Ç–∞–±–ª–∏—Ü—ñ –æ—Ä–¥–µ—Ä–±—É–∫—É (—Å—Ç–≤–æ—Ä–µ–Ω–Ω—è —Ä—è–¥–∫—ñ–≤)
    function renderTable() {
      const filterValue = tokenFilter.value;
      const filteredTokens = filterValue === 'all' ? tokens : [filterValue];
      const exchangesHeader = document.getElementById('exchanges-header');
      exchangesHeader.parentElement.innerHTML = `
        <th>Token</th>
        <th>Type</th>
        ${exchanges.map(exchange => `<th>${exchange}</th>`).join('')}
      `;
      const tableBody = document.getElementById('orderbook-body');
      tableBody.innerHTML = '';
      filteredTokens.forEach(token => {
        // –†—è–¥–æ–∫ –¥–ª—è Sell
        const sellRow = document.createElement('tr');
        sellRow.innerHTML = `
          <td rowspan="2" class="token-cell">${token}</td>
          <td class="type-cell">Sell</td>
          ${exchanges.map(exchange => `
            <td id="${token}-${exchange}-sell" class="sell-price">
              ${orderbooks[token]?.[exchange]?.best_sell || 'X X X'}
            </td>
          `).join('')}
        `;
        tableBody.appendChild(sellRow);
        // –†—è–¥–æ–∫ –¥–ª—è Buy
        const buyRow = document.createElement('tr');
        buyRow.innerHTML = `
          <td class="type-cell">Buy</td>
          ${exchanges.map(exchange => `
            <td id="${token}-${exchange}-buy" class="buy-price">
              ${orderbooks[token]?.[exchange]?.best_buy || 'X X X'}
            </td>
          `).join('')}
        `;
        tableBody.appendChild(buyRow);
      });
    }

    // –§—É–Ω–∫—Ü—ñ—è –¥–ª—è –∑–∞–ø–æ–≤–Ω–µ–Ω–Ω—è —Ç–∞–±–ª–∏—Ü—ñ –æ—Ä–¥–µ—Ä–±—É–∫—É
    function fillOrderbookTable(tbody, orders, isSell) {
        console.log('Filling orderbook table:', { tbody, orders, isSell });
        
        if (!tbody || !orders || !Array.isArray(orders)) {
            console.error('Invalid parameters for fillOrderbookTable:', { tbody, orders, isSell });
            return;
        }

        // –û—á–∏—â–∞—î–º–æ —Ç–∞–±–ª–∏—Ü—é
        tbody.innerHTML = '';

        // –î–ª—è sell –æ—Ä–¥–µ—Ä—ñ–≤ —Ä–æ–∑–≤–µ—Ä—Ç–∞—î–º–æ –ø–æ—Ä—è–¥–æ–∫ –≤—ñ–¥–æ–±—Ä–∞–∂–µ–Ω–Ω—è
        const displayOrders = isSell ? orders.slice().reverse() : orders;

        // –†–æ–∑—Ä–∞—Ö–æ–≤—É—î–º–æ –∑–∞–≥–∞–ª—å–Ω–∏–π –æ–±'—î–º –¥–ª—è –≥–ª–∏–±–∏–Ω–∏
        let totalVolume = 0;
        if (isSell) {
            // –î–ª—è sell –æ—Ä–¥–µ—Ä—ñ–≤ —Ä–∞—Ö—É—î–º–æ –≥–ª–∏–±–∏–Ω—É –∑ –∫—ñ–Ω—Ü—è
            for (let i = displayOrders.length - 1; i >= 0; i--) {
                const order = displayOrders[i];
                totalVolume += parseFloat(order[1]) * parseFloat(order[0]);
            }
        } else {
            displayOrders.forEach(order => {
                totalVolume += parseFloat(order[1]) * parseFloat(order[0]);
            });
        }

        console.log('Total volume:', totalVolume);

        // –ó–∞–ø–æ–≤–Ω—é—î–º–æ —Ç–∞–±–ª–∏—Ü—é
        let currentVolume = isSell ? totalVolume : 0;
        
        displayOrders.forEach(order => {
            const price = parseFloat(order[0]);
            const amount = parseFloat(order[1]);
            const total = price * amount;
            const row = document.createElement('tr');
            
            if (isSell) {
                currentVolume -= total;
                const depth = currentVolume + total; // –î–æ–¥–∞—î–º–æ total, —â–æ–± –ø–æ–∫–∞–∑–∞—Ç–∏ –ø—Ä–∞–≤–∏–ª—å–Ω—É –≥–ª–∏–±–∏–Ω—É –¥–ª—è –ø–æ—Ç–æ—á–Ω–æ–≥–æ —Ä—ñ–≤–Ω—è
                row.innerHTML = `
                    <td class="price sell-price">${price.toFixed(8)}</td>
                    <td class="amount">${amount.toFixed(8)}</td>
                    <td class="total">${total.toFixed(2)}</td>
                    <td class="depth">${depth.toFixed(2)}</td>
                `;
            } else {
                currentVolume += total;
                row.innerHTML = `
                    <td class="price buy-price">${price.toFixed(8)}</td>
                    <td class="amount">${amount.toFixed(8)}</td>
                    <td class="total">${total.toFixed(2)}</td>
                    <td class="depth">${currentVolume.toFixed(2)}</td>
                `;
            }

            tbody.appendChild(row);
        });

        // –Ø–∫—â–æ —Ü–µ sell –æ—Ä–¥–µ—Ä–∏, –ø—Ä–æ–∫—Ä—É—á—É—î–º–æ –¥–æ –Ω–∏–∑—É
        if (isSell) {
            tbody.scrollTop = tbody.scrollHeight;
        }

        console.log('Table filled with orders');
    }

    // –§—É–Ω–∫—Ü—ñ—è –¥–ª—è –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –æ—Ä–¥–µ—Ä–±—É–∫—ñ–≤
    function updateOrderbooks(token, exchange, isRightClick = false) {
        console.log('Updating orderbooks:', { token, exchange, isRightClick });
        
        // –í–∏–∑–Ω–∞—á–∞—î–º–æ —è–∫—É —Ç–∞–±–ª–∏—Ü—é –æ–Ω–æ–≤–ª—é–≤–∞—Ç–∏
        const targetContainer = isRightClick ? 
            document.querySelector('.orderbook-table-container:last-child') : 
            document.querySelector('.orderbook-table-container:first-child');

        // –û—á–∏—â–∞—î–º–æ —Ç—ñ–ª—å–∫–∏ —Ç–∞–±–ª–∏—Ü—ñ –≤ —Ü—å–æ–º—É –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ñ
        const targetTbody = targetContainer.querySelectorAll('.orderbook-table tbody');
        targetTbody.forEach(tbody => {
            tbody.innerHTML = '<tr><td colspan="3">–ù–µ–º–∞—î –¥–∞–Ω–∏—Ö</td></tr>';
        });

        // –û—á–∏—â–∞—î–º–æ –∑–∞–≥–æ–ª–æ–≤–æ–∫ —Ç—ñ–ª—å–∫–∏ —Ü—ñ—î—ó —Ç–∞–±–ª–∏—Ü—ñ
        const title = targetContainer.querySelector('.orderbook-title');
        title.textContent = `Orderbook ${token} - ${exchange}`;

        // –û–Ω–æ–≤–ª—é—î–º–æ –∑–Ω–∞—á–µ–Ω–Ω—è –≤ –∫–æ–º–±–æ–±–æ–∫—Å–∞—Ö
        if (isRightClick) {
            rightExchangeSelect.value = exchange;
            rightTokenSelect.value = token;
        } else {
            leftExchangeSelect.value = exchange;
            leftTokenSelect.value = token;
        }

        // –û—Ç—Ä–∏–º—É—î–º–æ –¥–∞–Ω—ñ –∑ –±–µ–∫–µ–Ω–¥—É
        if (socket && socket.readyState === WebSocket.OPEN) {
            console.log('Sending get_orderbook request:', { token, exchange });
            socket.send(JSON.stringify({
                action: 'get_orderbook',
                token: token,
                exchange: exchange
            }));
        } else {
            console.error('WebSocket is not connected');
        }
    }

    // –î–æ–¥–∞—î–º–æ –æ–±—Ä–æ–±–Ω–∏–∫–∏ –∫–ª—ñ–∫—ñ–≤ –¥–æ –∫–ª—ñ—Ç–∏–Ω–æ–∫ —Ç–∞–±–ª–∏—Ü—ñ
    document.addEventListener('DOMContentLoaded', function() {
        // –Ü–Ω—ñ—Ü—ñ–∞–ª—ñ–∑—É—î–º–æ –≥–ª–æ–±–∞–ª—å–Ω—ñ DOM –µ–ª–µ–º–µ–Ω—Ç–∏
        leftExchangeSelect = document.getElementById('left-exchange-select');
        leftTokenSelect = document.getElementById('left-token-select');
        rightExchangeSelect = document.getElementById('right-exchange-select');
        rightTokenSelect = document.getElementById('right-token-select');
        
        const orderbookBody = document.getElementById('orderbook-body');
        
        orderbookBody.addEventListener('click', function(e) {
            const cell = e.target.closest('td');
            if (!cell) return;

            const row = cell.closest('tr');
            const tokenCell = row.querySelector('.token-cell');
            
            if (!tokenCell) return;

            // –û—Ç—Ä–∏–º—É—î–º–æ —Ç–æ–∫–µ–Ω —ñ –±—ñ—Ä–∂—É –∑ ID –∫–æ–º—ñ—Ä–∫–∏
            const cellId = cell.id;
            const [token, exchange, type] = cellId.split('-');
            
            if (!token || !exchange) return;
            
            console.log('Left click on cell:', { token, exchange, type });
            updateOrderbooks(token, exchange, false);
        });

        orderbookBody.addEventListener('contextmenu', function(e) {
            e.preventDefault();
            
            const cell = e.target.closest('td');
            if (!cell) return;

            const row = cell.closest('tr');
            const tokenCell = row.querySelector('.token-cell');
            
            if (!tokenCell) return;

            // –û—Ç—Ä–∏–º—É—î–º–æ —Ç–æ–∫–µ–Ω —ñ –±—ñ—Ä–∂—É –∑ ID –∫–æ–º—ñ—Ä–∫–∏
            const cellId = cell.id;
            const [token, exchange, type] = cellId.split('-');
            
            if (!token || !exchange) return;
            
            console.log('Right click on cell:', { token, exchange, type });
            updateOrderbooks(token, exchange, true);
        });
    });

    // –û–±—Ä–æ–±–Ω–∏–∫–∏ –¥–ª—è –∫–æ–º–±–æ–±–æ–∫—Å—ñ–≤
    document.addEventListener('DOMContentLoaded', function() {
      const leftExchangeSelect = document.getElementById('left-exchange-select');
      const leftTokenSelect = document.getElementById('left-token-select');
      const rightExchangeSelect = document.getElementById('right-exchange-select');
      const rightTokenSelect = document.getElementById('right-token-select');

      function updateExchangeSelects() {
        const exchangeOptions = exchanges.map(exchange => `<option value="${exchange}">${exchange}</option>`).join('');
        leftExchangeSelect.innerHTML = '<option value="">–í–∏–±–µ—Ä—ñ—Ç—å –±—ñ—Ä–∂—É</option>' + exchangeOptions;
        rightExchangeSelect.innerHTML = '<option value="">–í–∏–±–µ—Ä—ñ—Ç—å –±—ñ—Ä–∂—É</option>' + exchangeOptions;
      }
      function updateTokenSelects() {
        const tokenOptions = tokens.map(token => `<option value="${token}">${token}</option>`).join('');
        leftTokenSelect.innerHTML = '<option value="">–í–∏–±–µ—Ä—ñ—Ç—å —Ç–æ–∫–µ–Ω</option>' + tokenOptions;
        rightTokenSelect.innerHTML = '<option value="">–í–∏–±–µ—Ä—ñ—Ç—å —Ç–æ–∫–µ–Ω</option>' + tokenOptions;
      }
      function updateSelects() {
        updateExchangeSelects();
        updateTokenSelects();
      }
      leftExchangeSelect.addEventListener('change', function() {
        const token = leftTokenSelect.value;
        if (token && this.value) updateOrderbooks(token, this.value, false);
      });
      leftTokenSelect.addEventListener('change', function() {
        const exchange = leftExchangeSelect.value;
        if (exchange && this.value) updateOrderbooks(this.value, exchange, false);
      });
      rightExchangeSelect.addEventListener('change', function() {
        const token = rightTokenSelect.value;
        if (token && this.value) updateOrderbooks(token, this.value, true);
      });
      rightTokenSelect.addEventListener('change', function() {
        const exchange = rightExchangeSelect.value;
        if (exchange && this.value) updateOrderbooks(this.value, exchange, true);
      });
      const originalHandleMessage = handleMessage;
      handleMessage = function(message) {
        originalHandleMessage(message);
        if (message.type === 'initial_data') updateSelects();
      };
    });

    function refreshPrices() {
      if (socket && socket.readyState === WebSocket.OPEN) {
        socket.send(JSON.stringify({ action: 'update_prices' }));
      }
    }
    function findArbitrageOpportunities() {
      // –†–µ–∞–ª—ñ–∑–∞—Ü—ñ—è –ø–æ—à—É–∫—É –∞—Ä–±—ñ—Ç—Ä–∞–∂—É
      console.log("Searching arbitrage opportunities...");
    }

    // –î–æ–¥–∞—î–º–æ —Ñ—É–Ω–∫—Ü—ñ–æ–Ω–∞–ª –ø–µ—Ä–µ–º–∏–∫–∞–Ω–Ω—è —Ç–µ–º–∏
    const themeToggle = document.getElementById('theme-toggle');
    const themeIcon = document.getElementById('theme-icon');
    const themeText = document.getElementById('theme-text');
    
    themeToggle.addEventListener('click', () => {
      document.body.classList.toggle('light-theme');
      if (document.body.classList.contains('light-theme')) {
        themeIcon.textContent = 'üåô';
        themeText.textContent = '–¢–µ–º–Ω–∞ —Ç–µ–º–∞';
      } else {
        themeIcon.textContent = '‚òÄÔ∏è';
        themeText.textContent = '–°–≤—ñ—Ç–ª–∞ —Ç–µ–º–∞';
      }
    });

    // –î–æ–¥–∞—î–º–æ –æ–±—Ä–æ–±–Ω–∏–∫ –¥–ª—è –ø–æ–ª—è –≤–≤–æ–¥—É —Ç–∞ –∫–Ω–æ–ø–∫–∏ –ø–æ—à—É–∫—É
    const tokenInput = document.getElementById('token-input');
    const searchBtn = document.getElementById('search-btn');

    // –ü–æ—à—É–∫ –ø—Ä–∏ –≤–≤–µ–¥–µ–Ω–Ω—ñ
    tokenInput.addEventListener('input', function() {
      const searchTerm = this.value.trim().toUpperCase();
      filterTable(searchTerm);
    });

    // –ü–æ—à—É–∫ –ø–æ –∫–Ω–æ–ø—Ü—ñ
    searchBtn.addEventListener('click', function() {
      const searchTerm = tokenInput.value.trim().toUpperCase();
      filterTable(searchTerm);
    });

    // –§—É–Ω–∫—Ü—ñ—è —Ñ—ñ–ª—å—Ç—Ä–∞—Ü—ñ—ó —Ç–∞–±–ª–∏—Ü—ñ
    function filterTable(searchTerm) {
      const rows = document.querySelectorAll('#orderbook-body tr');
      
      rows.forEach(row => {
        const tokenCell = row.querySelector('.token-cell');
        if (!tokenCell) return;
        
        const token = tokenCell.textContent;
        const shouldShow = token.includes(searchTerm);
        
        const nextRow = row.nextElementSibling;
        
        if (shouldShow) {
          row.style.display = '';
          if (nextRow) nextRow.style.display = '';
          row.classList.add('highlight-row');
          if (nextRow) nextRow.classList.add('highlight-row');
        } else {
          row.style.display = 'none';
          if (nextRow) nextRow.style.display = 'none';
          row.classList.remove('highlight-row');
          if (nextRow) nextRow.classList.remove('highlight-row');
        }
      });
    }

    // –§—É–Ω–∫—Ü—ñ—è –¥–ª—è –ø–æ–∫–∞–∑—É —Å–ø–ª–∏–≤–∞—é—á–∏—Ö –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω—å
    function showToast(message, type = 'success') {
      const toastContainer = document.getElementById('toastContainer');
      const toast = document.createElement('div');
      toast.className = `toast ${type}`;
      toast.textContent = message;
      
      toastContainer.appendChild(toast);
      
      // –í–∏–¥–∞–ª—è—î–º–æ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è —á–µ—Ä–µ–∑ 3 —Å–µ–∫—É–Ω–¥–∏
      setTimeout(() => {
        toast.style.opacity = '0';
        setTimeout(() => {
          toastContainer.removeChild(toast);
        }, 300);
      }, 3000);
    }

    // –§—É–Ω–∫—Ü—ñ—è –¥–ª—è –≤—ñ–¥–ø—Ä–∞–≤–∫–∏ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω—å —á–µ—Ä–µ–∑ WebSocket
    function sendMessage(message) {
      if (socket && socket.readyState === WebSocket.OPEN) {
        socket.send(JSON.stringify(message));
        return true;
      }
      showToast('–ù–µ–º–∞—î –∑\'—î–¥–Ω–∞–Ω–Ω—è –∑ —Å–µ—Ä–≤–µ—Ä–æ–º', 'error');
      return false;
    }

    // –û–Ω–æ–≤–ª—é—î–º–æ –æ–±—Ä–æ–±–Ω–∏–∫ –¥–ª—è –∫–Ω–æ–ø–∫–∏ –¥–æ–¥–∞–≤–∞–Ω–Ω—è —Ç–æ–∫–µ–Ω—É
    document.getElementById('add-token-btn').addEventListener('click', function() {
      const newToken = tokenInput.value.trim().toUpperCase();
      
      if (!newToken) {
        showToast('–ë—É–¥—å –ª–∞—Å–∫–∞, –≤–≤–µ–¥—ñ—Ç—å –Ω–∞–∑–≤—É —Ç–æ–∫–µ–Ω—É', 'error');
        return;
      }
      
      if (!/^[A-Z0-9]+$/.test(newToken)) {
        showToast('–ù–∞–∑–≤–∞ —Ç–æ–∫–µ–Ω—É –ø–æ–≤–∏–Ω–Ω–∞ –º—ñ—Å—Ç–∏—Ç–∏ —Ç—ñ–ª—å–∫–∏ –ª—ñ—Ç–µ—Ä–∏ –∞–Ω–≥–ª—ñ–π—Å—å–∫–æ–≥–æ –∞–ª—Ñ–∞–≤—ñ—Ç—É —Ç–∞ —Ü–∏—Ñ—Ä–∏', 'error');
        return;
      }
      
      if (tokens.includes(newToken)) {
        showToast('–¶–µ–π —Ç–æ–∫–µ–Ω –≤–∂–µ –¥–æ–¥–∞–Ω–æ', 'error');
        return;
      }
      
      if (sendMessage({
        action: 'add_token',
        token: newToken
      })) {
        tokenInput.value = '';
      }
    });

    window.addEventListener('load', () => { connect(); });
    setInterval(() => { /* –¥–æ–¥–∞—Ç–∫–æ–≤—ñ –ø–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –¥—ñ—ó, —è–∫—â–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ */ }, 5000);
  </script>
</body>
</html>
